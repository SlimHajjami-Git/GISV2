<div class="monitoring-container">
  <div class="monitoring-header">
    <div class="header-left">
      <h1 class="page-title">
        <span class="title-icon">üì°</span>
        Monitoring en temps r√©el
      </h1>
      <div class="last-update">Derni√®re mise √† jour: {{ 'maintenant' }}</div>
    </div>

    <div class="header-actions">
      <button (click)="refresh()" class="btn-icon" title="Actualiser">
        <span>üîÑ</span>
      </button>
      <button (click)="changeViewMode('map')"
              [class.active]="viewMode === 'map'"
              class="btn-icon"
              title="Vue carte">
        <span>üó∫Ô∏è</span>
      </button>
      <button (click)="changeViewMode('list')"
              [class.active]="viewMode === 'list'"
              class="btn-icon"
              title="Vue liste">
        <span>üìã</span>
      </button>
      <button (click)="changeViewMode('split')"
              [class.active]="viewMode === 'split'"
              class="btn-icon"
              title="Vue mixte">
        <span>‚ö°</span>
      </button>
    </div>
  </div>

  <div class="stats-bar">
    <div class="stat-item">
      <div class="stat-icon">üöó</div>
      <div class="stat-content">
        <div class="stat-value">{{ stats().total }}</div>
        <div class="stat-label">Total</div>
      </div>
    </div>
    <div class="stat-item stat-online">
      <div class="stat-icon">‚úÖ</div>
      <div class="stat-content">
        <div class="stat-value">{{ stats().online }}</div>
        <div class="stat-label">En ligne</div>
      </div>
    </div>
    <div class="stat-item stat-moving">
      <div class="stat-icon">üèÉ</div>
      <div class="stat-content">
        <div class="stat-value">{{ stats().moving }}</div>
        <div class="stat-label">En mouvement</div>
      </div>
    </div>
    <div class="stat-item stat-stopped">
      <div class="stat-icon">‚è∏Ô∏è</div>
      <div class="stat-content">
        <div class="stat-value">{{ stats().stopped }}</div>
        <div class="stat-label">Arr√™t√©s</div>
      </div>
    </div>
    <div class="stat-item stat-offline">
      <div class="stat-icon">‚ùå</div>
      <div class="stat-content">
        <div class="stat-value">{{ stats().offline }}</div>
        <div class="stat-label">Hors ligne</div>
      </div>
    </div>
  </div>

  <div class="monitoring-content" [class.view-map]="viewMode === 'map'"
                                   [class.view-list]="viewMode === 'list'"
                                   [class.view-split]="viewMode === 'split'">
    @if (viewMode !== 'list') {
      <div class="map-container">
        <div class="map-controls">
          <div class="control-group">
            <button (click)="changeMapStyle('streets')"
                    [class.active]="mapStyle === 'streets'"
                    class="btn-control">
              Carte
            </button>
            <button (click)="changeMapStyle('satellite')"
                    [class.active]="mapStyle === 'satellite'"
                    class="btn-control">
              Satellite
            </button>
            <button (click)="changeMapStyle('terrain')"
                    [class.active]="mapStyle === 'terrain'"
                    class="btn-control">
              Terrain
            </button>
          </div>
        </div>
        <div id="tracking-map" class="map"></div>

        @if (selectedVehicle()) {
          <div class="vehicle-detail-panel">
            <div class="panel-header">
              <h3>{{ selectedVehicle()!.brand }} {{ selectedVehicle()!.model }}</h3>
              <button (click)="selectedVehicle.set(null)" class="btn-close">√ó</button>
            </div>
            <div class="panel-body">
              <div class="detail-row">
                <span class="detail-label">Immatriculation:</span>
                <span class="detail-value">{{ selectedVehicle()!.registration_number }}</span>
              </div>
              <div class="detail-row">
                <span class="detail-label">Statut:</span>
                <span class="detail-value" [class]="getVehicleStatusClass(selectedVehicle()!)">
                  {{ getVehicleStatusLabel(selectedVehicle()!) }}
                </span>
              </div>
              <div class="detail-row">
                <span class="detail-label">Vitesse:</span>
                <span class="detail-value">{{ selectedVehicle()!.currentSpeed || 0 }} km/h</span>
              </div>
              <div class="detail-row">
                <span class="detail-label">Kilom√©trage:</span>
                <span class="detail-value">{{ selectedVehicle()!.mileage }} km</span>
              </div>
              @if (selectedVehicle()!.currentLocation) {
                <div class="detail-row">
                  <span class="detail-label">Position:</span>
                  <span class="detail-value">
                    {{ selectedVehicle()!.currentLocation!.lat.toFixed(6) }},
                    {{ selectedVehicle()!.currentLocation!.lng.toFixed(6) }}
                  </span>
                </div>
              }
            </div>
            <div class="panel-actions">
              <button class="btn-secondary">Historique</button>
              <button class="btn-primary">Plus de d√©tails</button>
            </div>
          </div>
        }
      </div>
    }

    @if (viewMode !== 'map') {
      <div class="vehicles-panel">
        <div class="panel-filters">
          <div class="search-box">
            <span class="search-icon">üîç</span>
            <input
              type="text"
              placeholder="Rechercher un v√©hicule..."
              [(ngModel)]="searchQuery"
              (ngModelChange)="onSearchChange($event)"
              class="search-input"
            />
          </div>

          <select [(ngModel)]="filterStatus"
                  (ngModelChange)="onFilterStatusChange($event)"
                  class="filter-select">
            <option value="all">Tous les statuts</option>
            <option value="online">En ligne</option>
            <option value="moving">En mouvement</option>
            <option value="stopped">Arr√™t√©s</option>
            <option value="offline">Hors ligne</option>
          </select>
        </div>

        <div class="vehicles-list">
          @if (loading()) {
            <div class="loading-state">Chargement...</div>
          } @else if (filteredVehicles().length === 0) {
            <div class="empty-state">
              <div class="empty-icon">üöó</div>
              <p>Aucun v√©hicule trouv√©</p>
            </div>
          } @else {
            @for (vehicle of filteredVehicles(); track vehicle.id) {
              <div class="vehicle-item"
                   [class.selected]="selectedVehicle()?.id === vehicle.id"
                   (click)="selectVehicle(vehicle)">
                <div class="vehicle-icon">
                  <span class="status-indicator" [class]="getVehicleStatusClass(vehicle)"></span>
                  <span class="icon">üöó</span>
                </div>
                <div class="vehicle-info">
                  <div class="vehicle-name">{{ vehicle.brand }} {{ vehicle.model }}</div>
                  <div class="vehicle-plate">{{ vehicle.registration_number }}</div>
                  <div class="vehicle-status" [class]="getVehicleStatusClass(vehicle)">
                    {{ getVehicleStatusLabel(vehicle) }}
                    @if (vehicle.isOnline) {
                      <span class="vehicle-speed">‚Ä¢ {{ vehicle.currentSpeed || 0 }} km/h</span>
                    }
                  </div>
                </div>
                <div class="vehicle-actions">
                  <button class="btn-icon-small" title="Plus de d√©tails">‚Ä∫</button>
                </div>
              </div>
            }
          }
        </div>
      </div>
    }
  </div>
</div>
